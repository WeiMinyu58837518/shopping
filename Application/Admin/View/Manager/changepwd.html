<!DOCTYPE html>
<html>
  <head>
	<meta charset="utf-8">
    <title>登录</title>
    <link rel="stylesheet" type="text/css" href="__PUBLIC__/Admin/css/login.css">
    <style type="text/css">
        .login-bg{
            background: url(__PUBLIC__/Admin/img/login-bg-5.jpg) no-repeat center center fixed;
            background-size: 100% 100%;
            overflow-y: hidden;
        }
    </style>
  </head>
  
  <body class="login-bg">
    <div class="login-box">
        <header>
            <h1>后台管理系统</h1>
        </header>
        <div class="login-main">
			<form action="" class="form" method="post">          
				<div class="form-item">
					<label class="login-icon">
						<i></i>
					</label>
					<input type="text" id='username' name="username"  value="{$user_name}" placeholder="这里输入登录名" required readonly style="background-color: #9e997e">
				</div>
                <div class="form-item">
                    <label class="login-icon">
                        <i></i>
                    </label>
                    <input type="password" id="password" name="password" placeholder="这里输入原始密码" autofocus>
                </div>
                <div class="form-item">
                    <label class="login-icon">
                        <i></i>
                    </label>
                    <input type="password" id="newpwd_1" name="newpwd_1" placeholder="这里输入新密码">
                </div>
                <div class="form-item">
                    <label class="login-icon">
                        <i></i>
                    </label>
                    <input type="password" id="newpwd_2" name="newpwd_2" placeholder="这里再次输入新密码">
                </div>
                <div class="form-item verify">
                    <label class="login-icon">
                        <i></i>
                    </label>
                    <input type="text" id='verify' class="pull-left" name="yanzheng" placeholder="这里输入验证码">
                    <img class="pull-right" src="__CONTROLLER__/yanzheng" id="gh" onclick="this.src='__CONTROLLER__/yanzheng/_/'+Math.random()">
                    <div class="clear"></div>
                </div>
				<div class="form-item">
					<button type="button" class="login-btn" id="haha">
						修&emsp;&emsp;改
					</button>
				</div>
                <div class="form-item">
                    <button type="button" class="login-btn" id="" onclick="history.back()">
                        放&emsp;弃&emsp;修&emsp;改
                    </button>
                </div>
			</form>
            <div class="msg"></div>
		</div>
    </div>
    <script type="text/javascript" src='__PUBLIC__/Admin/js/jquery-3.1.1.min.js'></script>
    <script type="text/javascript">
//        $(function(){
//            $('.login-btn').on('click',function(){
//                if($('#username').val() == ''){
//                    $('.msg').html('登录名不能为空');
//                    return;
//                }
//                if($('#password').val() == ''){
//                    $('.msg').html('密码不能为空');
//                    return;
//                }
//                if($('#verify').val() == ''){
//                    $('.msg').html('验证码不能为空');
//                    return;
//                }
//                $('form').submit();
//
//            });
//        })
        $("#haha").click(function(){
            var data={
                username:$("#username").val(),
                password:$("#password").val(),
                newpwd_1:$("#newpwd_1").val(),
                newpwd_2:$("#newpwd_2").val(),
                yanzheng:$("#verify").val()
            };
            $.post('__CONTROLLER__/changepwd',data,function(a){
                if(a==1){
                    alert ("验证码错误");
                    $("#gh").attr("src","__CONTROLLER__/yanzheng/_/"+Math.random());
                }
                if(a==7){
                    alert ("两次输入密码不一致");
                    $("#gh").attr("src","__CONTROLLER__/yanzheng/_/"+Math.random());
                }
                if(a==3){
                    alert ("原账号或密码错误");
                    $("#gh").attr("src","__CONTROLLER__/yanzheng/_/"+Math.random());
                }
                if(a==6){
                    alert ("密码修改成功");
                    location.href="__MODULE__/Login/login";
                }
                if(a==10){
                    alert ("新密码不能与原始密码相同");
                    $("#gh").attr("src","__CONTROLLER__/yanzheng/_/"+Math.random());
                }
            })
        })
        $("body").keydown(function(event){
            if(event.which==13){
                var data={
                    username:$("#username").val(),
                    password:$("#password").val(),
                    newpwd_1:$("#newpwd_1").val(),
                    newpwd_2:$("#newpwd_2").val(),
                    yanzheng:$("#verify").val()
                };
                $.post('__CONTROLLER__/changepwd',data,function(a){
                    if(a==1){
                        alert ("验证码错误");
                        $("#gh").attr("src","__CONTROLLER__/yanzheng/_/"+Math.random());
                    }
                    if(a==7){
                        alert ("两次输入密码不一致");
                        $("#gh").attr("src","__CONTROLLER__/yanzheng/_/"+Math.random());
                    }
                    if(a==3){
                        alert ("原账号或密码错误");
                        $("#gh").attr("src","__CONTROLLER__/yanzheng/_/"+Math.random());
                    }
                    if(a==6){
                        alert ("密码修改成功");
                        location.href="__MODULE__/Login/login";
                    }
                    if(a==10){
                        alert ("系统错误");
                        $("#gh").attr("src","__CONTROLLER__/yanzheng/_/"+Math.random());
                    }
                })
            }
        })
    </script>
  </body>
</html>
