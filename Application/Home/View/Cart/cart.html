<!DOCTYPE html>
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>购物车页面</title>

		<link href="__PUBLIC__/Home/css/amazeui.css" rel="stylesheet" type="text/css" />
		<link href="__PUBLIC__/Home/css/demo.css" rel="stylesheet" type="text/css" />
		<link href="__PUBLIC__/Home/css/cartstyle.css" rel="stylesheet" type="text/css" />
		<link href="__PUBLIC__/Home/css/optstyle.css" rel="stylesheet" type="text/css" />
		<style type="text/css">
			.nav-cont .nav-extra{background: url(__PUBLIC__/Home/images/extra.png);}
		</style>

		<script type="text/javascript" src="__PUBLIC__/Home/js/jquery.min.js"></script>

	</head>

	<body>

		<!--顶部导航条 -->
<include file="Common/top" />

		<!--悬浮搜索框-->

		<div class="nav white">
			<div class="logo"><img src="__PUBLIC__/Home/images/logo.png" /></div>
			<div class="logoBig">
				<li><img src="__PUBLIC__/Home/images/logobig.png" /></li>
			</div>

			<div class="search-bar pr">
				<a name="index_none_header_sysc" href="#"></a>
				<form>
					<input id="searchInput" name="index_none_header_sysc" type="text" placeholder="搜索" autocomplete="off">
					<input id="ai-topsearch" class="submit am-btn" value="搜索" index="1" type="submit">
				</form>
			</div>
		</div>

		<div class="clear"></div>

		<!--购物车 -->
		<div class="concent">
			<div id="cartTable">
				<div class="cart-table-th">
					<div class="wp">
						<div class="th th-chk">
							<div id="J_SelectAll1" class="select-all J_SelectAll">

							</div>
						</div>
						<div class="th th-item">
							<div class="td-inner">商品信息</div>
						</div>
						<div class="th th-price">
							<div class="td-inner">单价</div>
						</div>
						<div class="th th-amount">
							<div class="td-inner">数量</div>
						</div>
						<div class="th th-sum">
							<div class="td-inner">金额</div>
						</div>
						<div class="th th-op">
							<div class="td-inner">操作</div>
						</div>
					</div>
				</div>
				<div class="clear"></div>

				<tr class="item-list">
					<div class="bundle  bundle-last ">
						<div class="bundle-hd">
							<div class="bd-promos">
								<div class="bd-has-promo">已享优惠:<span class="bd-has-promo-content">省￥19.50</span>&nbsp;&nbsp;</div>
								<div class="act-promo">
									<a href="#" target="_blank">第二支半价，第三支免费<span class="gt">&gt;&gt;</span></a>
								</div>
								<span class="list-change theme-login">编辑</span>
							</div>
						</div>
						<div class="clear"></div>
						<div class="bundle-main">
							<volist name="data" id="v">
							<ul class="item-content clearfix" goods_id="{$v['goods_id']}" goods_attr_ids="{$v['goods_attr_ids']}" cart_id="{$v['id']|default=0}">
								<li class="td td-chk">
									<div class="cart-checkbox ">
										<input class="check row_check" name="items[]" value="170037950254" type="checkbox">
										<label for="J_CheckBox_170037950254"></label>
									</div>
								</li>
								<li class="td td-item">
									<div class="item-pic">
										<a href="#" target="_blank" data-title="{$v['goods']['goods_name']}" class="J_MakePoint" data-point="tbcart.8.12">
											<img src="{$v['goods']['goods_small_img']}" class="itempic J_ItemImg"></a>
									</div>
									<div class="item-info">
										<div class="item-basic-info">
											<a href="#" target="_blank" title="{$v['goods']['goods_name']}" class="item-title J_MakePoint" data-point="tbcart.8.11">{$v['goods']['goods_name']}</a>
										</div>
									</div>
								</li>
								<li class="td td-info">
									<div class="item-props item-props-can">
										<volist name="v['goods_attr']" id="n">
										<span class="sku-line">{$n['attr_name']}：{$n['attr_value']}</span>
										</volist>

										<i class="theme-login am-icon-sort-desc"></i>
									</div>
								</li>
								<li class="td td-price">
									<div class="item-price price-promo-promo">
										<div class="price-content">
											<div class="price-line">
												<em class="price-original">{$v['goods']['goods_price']}</em>
											</div>
											<div class="price-line">
												<em class="J_Price price-now" tabindex="0">{$v['goods']['goods_price']}</em>
											</div>
										</div>
									</div>
								</li>
								<li class="td td-amount">
									<div class="amount-wrapper ">
										<div class="item-amount ">
											<div class="sl">
												<input class="min am-btn sub_number" name="" type="button" value="-" />
												<input class="text_box current_number" name="number" type="text" value="{$v.number}" style="width:30px;" />
												<input class="add am-btn add_number" name="" type="button" value="+" />
											</div>
										</div>
									</div>
								</li>
								<li class="td td-sum">
									<div class="td-inner">
										<em tabindex="0" class="J_ItemSum number row_price">{$v['number']*$v['goods'][goods_price]}</em>
									</div>
								</li>
								<li class="td td-op">
									<div class="td-inner">
										<a title="移入收藏夹" class="btn-fav" href="#"> 移入收藏夹</a>
										<a href="javascript:;" data-point-url="#" class="delete"> 删除</a>
									</div>
								</li>
							</ul>
							</volist>
						</div>
					</div>
				</tr>
				<div class="clear"></div>
			</div>
			<div class="clear"></div>

			<div class="float-bar-wrapper">
				<div id="J_SelectAll2" class="select-all J_SelectAll">
					<div class="cart-checkbox">
						<input class="check-all check" name="select-all" value="true" type="checkbox">
						<label for="J_SelectAllCbx2"></label>
					</div>
					<span>全选</span>
				</div>
				<div class="operations">
					<a href="#" hidefocus="true" class="deleteAll">删除</a>
					<a href="#" hidefocus="true" class="J_BatchFav">移入收藏夹</a>
				</div>
				<div class="float-bar-right">
					<div class="amount-sum">
						<span class="txt">已选商品</span>
						<em id="J_SelectedItemsCount">0</em><span class="txt">件</span>
						<div class="arrow-box">
							<span class="selected-items-arrow"></span>
							<span class="arrow"></span>
						</div>
					</div>
					<div class="price-sum">
						<span class="txt">合计:</span>
						<strong class="price">¥<em id="J_Total">0</em></strong>
					</div>
					<div class="btn-area">
						<a href="javascript:void(0);" id="J_Go" class="submit-btn submit-btn-disabled" aria-label="请注意如果没有选择宝贝，将无法结算">
							<span>结&nbsp;算</span></a>
					</div>
				</div>

			</div>
		</div>

		<include file="Common/footer"/>
	</body>
	<script>
		$("#J_Go").click(function(){
			var checked_goods=$(".row_check:checked");
			if(checked_goods.length==0){
			    alert("请选择商品");
			    return;
			}
			var cart_ids='';
			$.each(checked_goods,function(i,v){
			   var tem=$(v).closest("ul").attr("cart_id");
			   cart_ids+=tem+',';
			})
			cart_ids=cart_ids.slice(0,-1);
			location.href="__CONTROLLER__/flow2/cart_ids/"+cart_ids;
		})
	</script>
	<script>
	$(function () {
	    //发送ajax更改商品数量的功能
		var changenumber=function(new_number,element){
		    var data={
		        "goods_id":$(element).closest("ul").attr("goods_id"),
		        "goods_attr_ids":$(element).closest("ul").attr("goods_attr_ids"),
				"number":new_number
			}
			$.post("__CONTROLLER__/changenumber",data,function(a){
			    if(a!=1){
			        alert("系统错误");
				}else{
			        $(element).closest("ul").find(".current_number").val(new_number);
			        //单价
					var price=$(element).closest("ul").find(".price-now").html();
			        $(element).closest("ul").find(".row_price").html(price * new_number);
                    zongjia();
                    zongshu();
				}
			})
		}
	    //点击加号
		$(".add_number").click(function(){
			var number=$(this).closest("ul").find(".current_number").val();
			var new_num=parseInt(number) +1;
			changenumber(new_num,this);
		})
		//点击减号
		$(".sub_number").click(function(){
            var number=$(this).closest("ul").find(".current_number").val();
            if(number<=1){
                return;
			}
            var new_num=parseInt(number) -1;
            changenumber(new_num,this);
		})
		//直接输入
		$(".current_number").change(function () {
			var number=parseInt($(this).val());
			if(isNaN(number)){
			    alert("输入错误");
			    return;
			}
			changenumber(number,this);
        })
    })	
	</script>
	<script>
		//定义一个删除商品的方法
		var deletecart=function(element){
            var goods_id=$(element).closest("ul").attr("goods_id");
            var goods_attr_ids=$(element).closest("ul").attr("goods_attr_ids");
            var data={
                "goods_id":goods_id,
                "goods_attr_ids":goods_attr_ids
            }
            $.post("__CONTROLLER__/deletecate",data,function(a){
                if(a!=1){
                    alert("系统错误");
                }else{
					$(element).closest("ul").remove();
                    zongjia();
                    zongshu();
                    quanxuan();
                }
            })
		}
		//删除商品
		$(function () {
			$(".delete").click(function(){
				deletecart(this);

			})
        })
		//定义一个计算总价的方法
		var zongjia=function(){
            var checked_goods=$(".row_check:checked");
            var danjia=0;
            var shuliang=0;
            var zongshu=0;
            $.each(checked_goods,function(index,value){
                danjia=$(value).closest("ul").find(".price-now").html();
                shuliang=$(value).closest("ul").find(".current_number").val();
                zongshu+=danjia*shuliang;
            })
            $("#J_Total").html(zongshu);
		}
		//对勾事件
		$(function(){
		    $(".row_check").change(function(){
				zongjia();
                zongshu();
                quanxuan();
			})
		})
		//全选对勾事件
		$(function(){
		    $(".check-all").change(function(){
				if($(".check-all").prop("checked")){
                    $(".row_check").prop("checked",true);
				}else{
                    $(".row_check").prop("checked",false);
				}
                zongjia();
                zongshu();
			})
		})
		//计算商品总数的方法
		var zongshu=function(){
		    var chacked_goods=$(".row_check:checked");
		    var zongshu=0;
			$.each(chacked_goods,function(i,v){
			    zongshu+=$(v).closest("ul").find(".current_number").val();
			})
			$("#J_SelectedItemsCount").html(zongshu);
		}
		//当单个商品都选中的时候全选按钮变成选中状态
		var quanxuan=function(){
            var xuanzhong=$(".row_check:checked").length;
            var zongshu=$(".row_check").length;
            if(xuanzhong==zongshu){
                $(".check-all").prop("checked",true);
			}else{
                $(".check-all").prop("checked",false);
			}
		}
	</script>
</html>